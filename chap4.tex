%% This is an example first chapter.  You should put chapter/appendix that you
%% write into a separate file, and add a line \include{yourfilename} to
%% main.tex, where `yourfilename.tex' is the name of the chapter/appendix file.
%% You can process specific files by typing their names in at the 
%% \files=
%% prompt when you run the file main.tex through LaTeX.
\chapter{Data Analysis}

\section{Analysis Tools}

In this thesis, the analysis tools we use is based on Macbook computers, and CMS high computing, linux shell script, C++ programing language, and ROOT analysis package for high energy physics experiments. The machine performing the analysis includes CERN lxplus, MIT Tier-2 submit, Data file are saved as ROOT files format. Data samples are processed with crab CERN lxplus and MIT submit condor job submission with parallel computing framework. The core software for the data process and analysis is the CMS software (CMSSW\_10\_3\_4). The codes for the analysis software is documented on github and gitlab. Throughout the analysis, we use Poison statistics to interpret the statistical uncertainties of the data. In the limit of high statistics, it is approximately equivalent to Gaussian Statistics. In the limit of low statistics, it is different from Gaussian Statistics. These tools are crucial for me to finish the analysis and present the results.

\section{Analysis Strategies}

\subsection{Physics Goals}

The exclusive productions of b hadrons in different collision systems are necessary to study beauty energy loss and hadronization mechanisms. In this thesis, we propose to fully reconstruct $B^0_s$ ($b\bar s$) and $B^+$ ($\bar b u$) mesons in pp and PbPb collisions at $\sqrt{s_{NN}} = $ 5.02 TeV with the CMS experiment. We aim at measuring precisely their cross section, yield ratios, and nuclear modification factor of fully reconstructed $B^0_s$ and $B^+$ mesons via the decay channels of  to investigate beauty quark production and hadronization in vacuum and QGP. We hope to have a conclusive measurement of $B^0_s/B^+$ ratio to pinpoint the effect of strangeness enhancement in QGP on beauty hadronization and test theoretical model calculations \cite{StrangetoLight} with both fragmentation \cite{} and quark coalescence \cite{} mechanisms. Therefore, we would like to present our experimental measure over a width range of $p_T$ and centrality. We are particularly interested in the very low $p_T$ region where the slow moving beauty quark will pick up the nearby light quarks in the QGP while such mechanism is not expected to occur in the vacuum \cite{}. The $R_{AA}$ down to low $p_T$ will constrain understand beauty quark energy mechanism in the QGP medium. These will studies will be crucial for us to understand beauty quark diffusion coefficient and probe the inner workings of QGP in order to provide insights with the one of the open question in high energy nuclear physics. 

\subsection{General Workflow}

Figure \ref{BsBPWorkFlow} shows workflow we designed to fully reconstructed $B^0_s$ and $B^+$ mesons from final state particles via the exclusive decay modes. The $B^0_s$ is fully reconstructed from the decay channel of $B^0_s \rightarrow J/\psi \phi \rightarrow \mu^+\mu^- K^+K^-$, which has a fragmentation fraction of $f(b\rightarrow B_s^0) =$ 0.103 and a decay branching fraction $BR(B^0_s \rightarrow J/\psi \phi \rightarrow \mu^+\mu^- K^+K^-) = 3.17 \times 10^{-5}$ $B^+ \rightarrow J/\psi K^+\rightarrow \mu^+\mu^- K^+$ with the CMS detector. The $B^+$ is fully reconstructed from the decay channel of $B^+ \rightarrow J/\psi \phi \rightarrow \mu^+\mu^- K^+$, which has a fragmentation fraction of $f(b\rightarrow B^+) =$ 0.401 and a decay branching fraction $BR(B^+ \rightarrow J/\psi \phi \rightarrow \mu^+\mu^- K^+K^-) = 6.02 \times 10^{-5}$ $B^+ \rightarrow J/\psi K^+\rightarrow \mu^+\mu^- K^+$ with the CMS detector. 



\begin{figure}[hbtp]
\begin{center}
\includegraphics[width=0.65\textwidth]{Figures/Chapter4/BsBPWorkFlow.pdf}
\caption{The block diagram of the workflow with major steps for both B-meson cross section measurement is shown above.}
\label{BsBPWorkFlow}
\end{center}
\end{figure} 

Figure \ref{BsBPRECO} shows pictorially the decay topology of fully reconstructed B meson and our reconstruction strategies

\begin{figure}[hbtp]
\begin{center}
\includegraphics[width=0.86\textwidth]{Figures/Chapter4/BsBPRECO.pdf}
\caption{The strategies to fully reconstruct $B^0_s$ and $B^+$ in the selected exclusive decay modes are shown above.}
\label{BsBPRECO}
\end{center}
\end{figure} 

In this thesis, we propose to measure $B^0_s$ and $B^+$ cross section in the $p_T$ bin of [7, 10, 15, 20, 50] GeV/c within centrality [0, 90] and centrality bin of [0, 30, 90] with $p_T$ [10, 50]. The rapidity range of B-meson measurements are confined in $B |y| < 2.4$.

\subsection{Technical Challenges}

Despite the excellent muon, tracking, vertexing capabilities of the CMS detector, there are still many challenges for the analysis. Below is a list of challenges in the B-meson analysis 

\begin{itemize}
\item The small B meson decay branching ratio, which on in the order of 10$^{-5}$, and limited luminosity of the sample: $S \downarrow$ 
\item Huge combinatorial background without hadron particle identification, particularly in PbPb collisions and at low $p_T$:  $B \uparrow$ 
\item Low muon acceptance of at very low $p_T$: $S \downarrow$ 
\item High fake track rate with low tracking efficiency at very low $p_T$: $B \uparrow$ 
\end{itemize}

Here, $S$ stands for signal and $B$ stands for background. These factors will all lower the signal-to-background ratio, which makes challenging to fully reconstruct B mesons, particularly at very low $p_T$. In this thesis, to reduce the signal to background ratio and the systematic uncertainties, we will employ a novel approaching machine learning with multivariate analysis and the elaborated single particle efficiency correction method to perform the measurements.


\section{Analysis Samples}


\subsection{Dimuon Triggered Datasets}

In this part of the thesis, I focus on the studying beauty production and hadronization in QGP. Therefore, this analysis is performed using the 2018 PbPb data at $\sqrt{s_{NN}}$=5.02 TeV, which has an integrated luminosity of 1.7 $nb^{-1}$. 
The analysis uses the dimuon primary datasets (\textit{DoubleMu} PD). The full name of the used datasets and their corresponding luminosity can be found in Table~\ref{tab:lumi}.

\begin{table}[htb]
\begin{center}
\caption{List of PbPb HLT datasets and triggers with the corresponding integrated luminosities used in the analysis.}
\label{tab:lumi}
 \tiny
 \begin{tabular}{ l | l | l | l | }
 System& Primary dataset & Trigger & Luminosity\\
  \hline\hline 
PbPb & \verb#/HIDoubleMuonPsiPeri/HIRun2018A-04Apr2019-v1/AOD# & \verb# HLT_HIL3Mu0NHitQ10_L2Mu0_MAXdR3p5_M1to5_v1 # & 522 $nb^{-1}$\\
  PbPb & \verb#/HIDoubleMuon/HIRun2018A-04Apr2019-v1/AOD # & \verb# HLT_HIL3Mu0NHitQ10_L2Mu0_MAXdR3p5_M1to5_v1 # & 1124 $nb^{-1}$ \\
  \hline
  PbPb & Combined All & & 1.657 ($\sim$ 1.7) $nb^{-1}$ \\
 \end{tabular}
\end{center}
\end{table}

The details of the dimuon trigger selection to collect the data sample is explained in 2.2.5. In addition, an Muon JSON to select good luminosity sections in the PbPb dataset is applied. Both $B^0_s$ and $B^+$ data come from this sample. However, in the later stage, the B meson candidates are saved in different channels based on the reconstruction.

\subsection{Monte Carlo Simulations Samples}

Dedicated PbPb $B^0_s$ and $B^+$ samples are generated in order to estimate the acceptance and selection efficiencies, to study the background components, and to evaluate systematic uncertainties. {\sc PYTHIA8} Tune CUETPM8~\cite{PYTHIAFrag,PYTHIA2}, set to generate inclusive (all quark/antiquark, as well as gluon initiated) QCD processes, was used to generate at 5.02 TeV the signal. Several preselections at the generation steps are applied in order to optimize the generation process and conserve resources.

For $B^0_s$, only signal events were kept with at least one $B^0_s$ (forced to decay through the channel $B^0_s \rightarrow J/\psi \phi \rightarrow \mu^+\mu^-K^+K^-$ by means of the {\sc evtgen} package~\cite{EvtGen}), with $p_{T}>$ 5.0 GeV/c, and $|\eta|<$ 2.4. In addition, the $J/\psi$ and $\phi$ meson, are forced to decay in the two muons and two kaons respectively. Final state radiations are generated using {\sc photos}~\cite{PHOTOS}. The selected signal B mesons {\sc PYTHIA8} events were embedded into a PbPb background simulated with the {\sc HYDJET}  (version 1.8, tune ``Drum'' for the prompt and non-prompt $J/\psi$ MC and tune "Cymbal5Ev8" for the $B^0_s$ signal MC)~\cite{HYDJET} event generator.

For $B^+$, similar requirements for MC generation are applied except a different decay channel $B^0_s \rightarrow J/\psi K^+ \rightarrow \mu^+\mu^-K^+$ is used.

For $B^0_s$ and $B^+$, around fifty thousand events were generated in 5 $\hat{p}_{T}$ bins, with boundaries of $\hat{p}_{T} >$ 0, 5, 15, 30, 50, in both signal only, and embedded samples. The high $\hat{p}_{T}$ selections are used to enrich the high $p_T$ B meson statistics in order to perform efficiency correction. 

We should note that in there are two components in the MC sample. The truth information about the particles generated in the simulation, which is call generated (GEN), and the reconstructed one smeared according to the CMS detector effects, which is called reconstructed (RECO). Due to the nature of MC generation, we will need to reweigh on MC in order to model the data.

In addition to the $B^0_s$ and $B^+$, a sample of inclusive b hadron to $J/\psi$ (non-prompt) MC is also simulated to study the possible background contribution to the B-meson analysis due to 


\subsection{$\hat{p}_{T}$ Reweighing}


As we mention above, different $\hat{p}_{T}$ cut is applied to generate the MC samples. When merging the samplings, a  $\hat{p}_{T}$ weight based on beauty production cross section is required to apply to the MC in order to obtain a smooth distribution that can model the real data. Figure \ref{GENPTDIS} shows the generated $p_T$ ($Gp_T$) distribution of $J/\psi$, $B^+$ , and $B^0_s$ before and after applying the $\hat{p}_{T}$ weight:


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.90\textwidth]{Figures/Chapter4/JPsiGenpT.png}
\includegraphics[width= 0.90\textwidth]{Figures/Chapter4/BPlusGenpT.png}
\includegraphics[width= 0.90\textwidth]{Figures/Chapter4/BsGenpT.png}
\caption{ $J/\psi$ generated $p_{T}$ distribution before (upper left) and after (upper right) $\hat p_{T}$ reweighing, $B^+$ generated $p_{T}$ distribution before (middle left) and after (middle right) $\hat p_{T}$ reweighing, and $B_s^0$ generated $Gp_{T}$ distribution before (lower left) and after (lower right) $\hat p_{T}$ reweighing are shown above.}
\label{GENPTDIS}
\end{center}
\end{figure}


\subsection{RECO B-meson ${p}_{T}$ Reweighing}

Then, we also check if this smooth $Gp_T$ shape in fact correspond to a good agreement between the data and MC in the RECO side. Therefore, we take the ratio of the normalized data raw yield to the normalized MC raw yield and perform a variety of functions to fit the distribution. In our studies, we use Linear ($y = p_0 + p_1 x$), Quadratic ($y = p_0 + p_1 x + p_2 x^2$), Linear + Inverse  ($y = p_1 x + \frac{p_2}{x}$), Linear + Square Root ($y = p_0 + p_1 x + p_2 \sqrt{x}$), Linear + Log ($y = p_0 + p_1 x + p_2 \log{x}$). The data vs MC raw yield shape and our fitting results on spectra ratio are show as follows \ref{BsBptWeight} and  \ref{BPBptWeight} for $B^0_s$ and $B^+$ respectfully 



\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.97\textwidth]{Figures/Chapter4/BsBptDataMC.png}
%\includegraphics[width= 0.55\textwidth]{Figures/Chapter4/BsBptDataMCAfter.png}
%\caption{ $B^0_s$ $p_T$ normalized raw yields obtained in PbPb MC and Data are shown above on the top left panel. The data/MC ratio and different fitting functions: Linear (Red), Quadratic(Green), Linear + Inverse (Blue), Linear + Square Root (Purple), and Linear + Log (Cyan) and their $\chi^2$ are shown above on the top right panel. The bottom plots are the data/MC reweighed yields with different functions from the fit on the top right panel. We can see that they all get closer to unity compared unweighted MC. The Linear + Log (Cyan) line, which has the smallest $\chi^2$ and is closest to unity after applying the weight to the MC. Hence, Linear + Log function is use as nominal for our $B^0_s$ $p_{T}$ reweighing. All other fitting function are used as reference to calculate the $p_T$ shape systematic uncertainties.}
\caption{ $B^0_s$ $p_T$ normalized raw yields obtained in PbPb MC and Data are shown above on the top left panel. The data/MC ratio and different fitting functions: Linear (Red), Quadratic(Green), Linear + Inverse (Blue), Linear + Square Root (Purple), and Linear + Log (Cyan) and their $\chi^2$ are shown above on the top right panel. The bottom plots are the data/MC reweighed yields with different functions from the fit on the top right panel.}
\label{BsBptWeight}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPBptDataMC1.pdf}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPBptDataMC2.pdf}
\caption{The normalized $B^+$ raw yield in MC (green) and Data (red) as a function RECO $B^+$ $p_T$ (left) and the fourth order polynomial fits to their ratio (right) are shown above.}
\label{BPBptWeight}
\end{center}
\end{figure}


\subsection{Centrality Reweighing}

Because the MC simulations employ PYTHIA embedded into a PbPb background simulated, they do not model the centrality of nucleus-nucleus collision well. Therefore, the MC simulations are also reweighed in order to match the centrality distribution in data. In the middle panel of Figure \ref{CentComp}, the centrality distribution of the MC simulation (red) is compared to the one in data (blue), before the re-weighting. Each unit (hiBin) on the x-axis represents 0.5\% centrality. The number of binary collisions $N_{coll}$ was used as the weight to scale the MC centrality, and the distribution presented in the right panel of Figure 4 was obtained. 

\begin{figure}[hbtp]
\begin{center}
\includegraphics[width=1.10\textwidth]{Figures/Chapter4/CentralityWeight.pdf}
\caption{The comparison between $N_{coll}$ and Data vs hiBin (left), centrality distribution of MC (red) and data (blue) in PbPb collisions in the centrality interval 0-100\% without $N_{coll}$ weight (middle), and with $N_{coll}$ weight (right) are shown above.}
\label{CentComp}
\end{center}
\end{figure} 


A better centrality agreement between the data and the MC is seen after the reweighing process. 

\subsection{PV$_{z}$ Reweighing}


In addition to above pt shape and centrality reweighing, there must be a primary vertex $z$ position (PV$_{z}$) reweighing due to incorrect modeling of the primary vertex location and resolution in the MC simulation. In fact, it is known that the MB samples use for embedding for PbPb signal MC samples (with Cymbal5Ev8 tune) has a PV$_{z}$ offset. Also, the offsets between data and MC in the X and Y directions are observed in the 2018 PbPb collisions. To remedy this, a Gaussian fit is applied to both the data and MC PV$_{z}$ distributions, as showed in Fig.~\ref{PVZPlot}. The black markers represent the distribution points for MC (left), and data (right), while the red line represents the fit result. Then, the ratio between the two fit results is taken as the weighting function. The result after this weighting can be found in Fig. \ref{PVZPlot} But we should note that this analysis is not sensitive to the absolute value of the PV position because the reconstruction of the B-meson rely only on the relative distance between PV and B-meson reconstructed vertex which will be presented in the later sections.

\begin{figure}
\begin{center}
\includegraphics[width= 1.10\textwidth]{Figures/Chapter4/PVzWeightPbPb.pdf}
\caption{Primary vertex z position (PV$_{z}$) distribution, fitted with a gaussian function in PbPb MC simulations (left), in PbPb data (middle), PV$_{z}$ reweighed MC to data with ratio of data-to-MC Gaussian Fits (right) are shown above. The PV$_z$ distributions are well described by the Gaussian function and reweighing reduces the MC-data discrepancy.}
\label{PVZPlot}
\end{center}
\end{figure}

A almost perfect MC-data agreement after PV$_{z}$ reweighed is observed above. After these standard reweighing procedures, the residue disagreement between MC and data will be considered as a source of systematic uncertainties.


\clearpage

\section{Global Event Observables} 

The global event observables characterize general conditions of heavy-ion collision. In this analysis, we decide to use another set of quantities including total number of MB events to represent the luminosity and average number of participants $N_{parts}$ to represent centrality. In addition, to compare with $pp$ collisions, we also need to scale the cross section in PbPb according to . Therefore, we will determine the all the global event observable including total number of minimum bias events ($N_{MB}$), centrality, number of participant nucleons $N_{part}$, number of binary collisions $N_{coll}$, and nuclear overlapping function $T_{AA}$ in dimuon PbPb dataset in the follow subsections.

\subsection{Total Number of Events}

As seen in Table \ref{tab:lumi}, the nominal luminosity of the dimuon PbPb dataset 1.7 $nb^{-1}$. However, this nominal luminosity has large uncertainties and should be used in the analysis to measure the cross section. As mentioned previous in Chapter 2.2, the dimuon trigger, based on the MB trigger, will not save events that does not pass trigger selections. Hence, we can use the events of 1 PD MB datasets (PD0) via the follow formula to determine the actual number of MB events corresponding to the dimuon PbPb datasets: 


\begin{equation}
N_{MB} = \frac{N^{\mu\mu json}_{MB}}{\mathcal{L}_{MB trigger}^{\mu json}} \mathcal{L}_{\mu\mu trigger}^{\mu\mu json}
\end{equation}

The definition of the variables in the formula are as follows:


\textbf{$N_{MB}$:} The number of minimum bias events in dimuon PD with muon json.

\textbf{$N^{\mu json}_{MB}$:} The number of event of all MB PDs with muon json. 

\textbf{$\mathcal{L}^{\mu json}_{MB}$:} The luminosity of all MB PDs with muon json.

\textbf{$\mathcal{L}_{\mu\mu trigger}^{\mu\mu json}$:} The luminosity of dimuon PD with muon json.

\iffalse 

To obtain the total number of minimum bias $N_{MB}$, first we process one PD (PD5) minimum bias events and count the total number of events for centrality at 0 - 90\% to obtain $N^{\mu\mu json}_{MB}$. Then, we run the brilcal for MB PD5 and sum the luminosity of HLT MB triggers: 

Trigger 1: ``HLT\_HIMinimumBias\_part0\_v1" 
 
Trigger 2: ``HLT\_HIMinimumBias\_SinglePixelTrack\_part0\_v1"
 
Trigger 3: ``HLT\_HIMinimumBias\_SinglePixelTrack\_NpixBypass\_part0\_v1" 
  
Trigger 4: ``HLT\_HIMinimumBias\_SinglePixelTrack\_NpixGated\_part0\_v1" 
 
to obtain $\mathcal{L}^{\mu\mu json}_{MB}$. 

Trigger 5: ``HLT\_HIL3Mu0NHitQ10\_L2Mu0\_MAXdR3p5\_M1to5\_v1" 

to obtain $\mathcal{L}^{\mu\mu json}_{MB}$. 

Table ~\ref{tab:lumibreadown} shows the luminosity of Trigger 1 -- 5 above. The sum of trigger 1 -- 4 will be $\mathcal{L}^{\mu\mu json}_{MB}$ and trigger 5 will be $\mathcal{L}^{\mu\mu json}_{MB}$.

\begin{table}[h]
\begin{center}
\caption{Summary table of the luminosity of HLT triggers to obtain the number of minimum biased events.}
\vspace{1em}
\label{tab:lumibreadown}
  \begin{tabular}{ |c | c| }
      \hline
   HLT  & Luminosity ($\mu b^{-1}$)  \\
    \hline
    \hline 
 HLT\_HIMinimumBias\_part0\_v1        & 14.8269  \\
 `HLT\_HIMinimumBias\_SinglePixelTrack\_part0\_v1  & 1.3010  \\
HLT\_HIMinimumBias\_SinglePixelTrack\_NpixBypass\_part0\_v1 & 7.9468 \\
HLT\_HIMinimumBias\_SinglePixelTrack\_NpixGated\_part0\_v1 &  \\
    \hline 
Total & 24.0748  \\
    \hline 
HLT\_HIL3Mu0NHitQ10\_L2Mu0\_MAXdR3p5\_M1to5\_v1  & 1657.1320 \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}


We have also obtained the number of events by processing one of the MB sample. The total number of events can be found in Table \ref{tab:NMBEventsCent}. 

\begin{table}[h]
\begin{center}
\caption{Summary table of the total number of MB events vs centrality}
\vspace{1em}
\label{tab:NMBEventsCent}
  \begin{tabular}{ |c | c| }
    \hline 
Centrality & $ \mathcal{L}_{\mu\mu trigger}^{\mu\mu json}$ \\
     \hline
         \hline
0-10\% & 18276069  \\
10-20\%& 17680482  \\
20-30\% & 17687566 \\
30-40\% & 17684913 \\
40-50\% & 17685909 \\
50-60\% & 17680807 \\
60-70\% & 17686640 \\
70-80\% & 18375623 \\
80-90\% & 18749965 \\
0-30\% & 53644117 \\
30-90\% & 107863857 \\
0-90\% & 161507974 \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}

\fi

For 0 - 90\%, $N_{MB}^{\mu json}$ is 161507974. The number of events can then be computed as follows:

\begin{equation}
N_{MB} = \frac{N^{\mu json}_{MB}}{\mathcal{L}_{MB trigger}^{\mu json}} \mathcal{L}_{\mu\mu trigger}^{\mu json} = \frac{1657.1320 \mu b^{-1}}{24.0748  \mu b^{-1}} \times 161507974 =  1.1823737719 \times 10^{10} \simeq  \textbf{11.82 billion}
\end{equation}

Hence, the number of MB event for the dimuon PbPb data is $N_{MB} = $11.82 billion. Below, in Table \ref{NMBUsedCent}, we compile the number of minimum biased events $N_{MB}$ in 0 - 30\%, 30\% - 90\%,and 0 -90\%. 

\begin{table}[h]
\begin{center}
\caption{Summary table of the total number of MB events vs centrality}
\vspace{1em}
\label{NMBUsedCent}
  \begin{tabular}{ |c | c| }
    \hline 
Centrality & $N_{MB}$ (billion) \\
     \hline
         \hline
0-30\% &  3.941 \\
30-90\% & 7.882 \\
0-90\% & 11.82 \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}

%According to the official results from the CMS Global Observable Group, the number of events we obtains is about $N_{events} =$ 11968044281 $\simeq$ 12.0 billion for (0 - 90\%) centrality from using the brilcal to evaluate the luminosity and process MB PD0--5 with our muon JSON, which is very close our calculations: $N_{events} =$ 11.82 billion. Here, we will use the official results

\subsection{Centrality Definition}

For the 2018 PbPb dataset, the centrality is given in hiBin with 0.5\% increment. The hiBin is defined based on the HF response (hiHF). According to the Global observable, \ref{hiHFvsCent} is the hiHF as a function of centrality with uncertainties.


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/hiHFvsCent.png}
\caption{The nominal (black) and uncertainties band (green) hiHF vs hiBin for CMS 2018 PbPb dataset are shown above.}
\label{hiHFvsCent}
\end{center}
\end{figure}


We can compute the percent deviation nom of final results to estimate systematics due to uncertainties of centrality. 


\subsection{$\langle N_{part} \rangle$, $\langle N_{coll} \rangle$, $\langle T_{AA} \rangle$ vs Centrality}

As we discussed in the Glauber Model \cite{CentPlot,Glauber} section 1.5.7, the number of participant nucleons $N_{part}$, the number of binary nucleon-nucleon collisions, and nuclear over lapping function $T_{AA}$ are all functions of the event centrality. The CMS Global Observable group has computed the average $N_{part} $, $N_{coll} $, $T_{AA}$ and their uncertainties  for different centrality bins based on the Glauber Model. The selected results are shown Table \ref{GOvsCent} below


\begin{table}[h]
\begin{center}
\caption{Summary table of the total number of MB events vs centrality is shown below. The uncertainties are represented in terms of percentage in the parenthesis.}
\vspace{1em}
\label{GOvsCent}
  \begin{tabular}{ |c | c| c| c|}
    \hline 
Centrality &  $\langle N_{part} \rangle$ &$\langle N_{coll} \rangle$  & $\langle T_{AA} \rangle$  \\
     \hline
         \hline
0-30\% &  269.1 (0.39\%)  &  1042 (2.0\%) &	15.42 (2.0\%)   \\
30-90\% & 54.45 (1.5\%)   & 115.2 (3.6\%)  &   1.704 (3.6\%)  \\
0-90\% & 126.0 (0.67\%)   &  424.1(2.2\%)  &    6.274 (2.2\%)  \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}

The global observables $N_{MB}$, $N_{part}$, $N_{coll}$, and $T_{AA}$ will be used inputs for our B-meson analysis. 

\iffalse

\subsection{Number of Participant Nucleons}

\subsection{Number of Binary Collisions}


\fi

\subsection{Event Multiplicity}

Aside from $N_{MB}$, $N_{part}$, $N_{coll}$, and $T_{AA}$, event multiplicity is also an event observable. We count the number of tracks in each event with some track quality selections and use it to interpret the event multiplicity, which characterizes the event activity. The following is the selection criteria for 

Nevertheless, the event multiplicity is not used in PbPb analysis. It will be used in $pp$ analysis to study the $B^0_s/B^+$ ratio as a function of event multiplicity in $pp$ collisions.

%\section{Monte Carlo Simulations} 

%The Monte Carlo (MC) simulation on the B meson decay is essential to the analysis. It will plays an important role in both the signal extraction and efficiency correction.

%\subsection{PYTHIA}

%\subsection{Hydjet Embedding}

%\subsection{EvtGen Package}

%\subsection{MC reweighing}

\section{B meson Reconstruction} 

Now we look into each events of the PbPb dimuon dataset. It turns out that there is no PU in any event. Therefore, only one primary vertex for each event. We can then reconstruct the B meson candidates according to the final state muons and kaons tracks. In CMS, a dedicated software named ``\textit{Bfinder}'' is developed to perform B-meson reconstruction. Figure \ref{BsRECOWF} and \ref{BPRECOWF} show the workflow to fully reconstruct \textit{Bfinder} for $B^0_s$ and $B^+$ respectfully.


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.98\textwidth]{Figures/Chapter4/BsmesonWorkflow.png}
\caption{The schematic block diagram of the full reconstruction workflows for $B^0_s$ via the decay channel of $B_s^0 \rightarrow J/\psi \phi \rightarrow \mu^+\mu^- K^+K^-$ in the \textit{Bfinder} is shown above.}
\label{BsRECOWF}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.98\textwidth]{Figures/Chapter4/BPmesonWorkflow.png}
\caption{The schematic block diagram of the full reconstruction workflows for $B^+$ via the decay channel of $B^+ \rightarrow J/\psi K^+ \rightarrow \mu^+\mu^- K^+$ in the \textit{Bfinder} is shown above.}
\label{BPRECOWF}
\end{center}
\end{figure}

Here, we should note that since we do not have hadronic PID for the kaons, we assume the track to be kaons and assume the charged kaon PDG mass to the tracks \cite{AlphaTheoEx} to the tracks. Also, the invariant mass of muon pair is constrained to the nominal $J/\psi$ meson PDG mass ($m_{J/\psi}$ = 3.096916 GeV/c$^2$) \cite{AlphaTheoEx} instead of a distribution of the dimuon mass $m_{\mu\mu}$. The output file format of \textit{Bfinder} is an Ntuple. Finally, we do not distinguish particle and anti-particles during the B-meson reconstruction. Therefore, both $B^0_s$ and $\bar{B^0_s}$ as well as $B^+$ and $B^-$ are reconstructed. Here, for simplicity, we only mention the $B^0_s$ and $B^+$ throughout the thesis. Each event will have multiple B-meson candidates \ref{BCand}.

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BsSize.eps}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPSize.eps}
\caption{The number of reconstructed B-meson candidates per event distribution in the dimuon PbPb data for $B^0_s$ (left) and $B^+$ (right) are shown above. Multiple B-meson candidates are reconstructed in one event.}
\label{BCand}
\end{center}
\end{figure}


Their information, including invariant mass, $p_T$, and $y$ as well as their daughter particles kinematics such as $p_T$ and $\eta$, is saved as a form of vector in each event. In this thesis, we use B-meson Ntuples to perform our analysis.


%\subsection{Decay Channels}


\subsection{Event Selections}

To ensure the quality of inelastic hadronic collisions events for B-meson reconstruct, we apply the follow selections


\begin{itemize}
\item At least one reconstructed primary interaction vertex, formed by two or more tracks
\item The longitudinal distance from the center of the nominal interaction region of less than 15 cm along the beam axis: $|$PV$_{z}$$| < $ 15
\item Compatible shapes of the clusters in the pixel detector with those expected from particles produced by a PbPb collision \cite{EvtSel}
\item At least two towers in each of the HF detectors with energy deposits of more than 4GeV per tower  
\end{itemize}

\subsection{Track Selections}

In addition to event selection, we also apply track selections to improve the quality of the tracks and reject fake tracks. For $B^+$ we have the following selections

\begin{itemize}
\item General Tracks passing high purity selection (describe in section 3.4.2)
\item $|\eta| < 2.4$ and $p_T > 1$ GeV/c
\item $p_T$ momentum resolution: $\frac{\sigma_{p_T}}{p_T} < 0.1$
\item At least 10 hits in the pixel + strip tracker layers: $N_{hit} > 10$
\item (Track $\chi^2/ndf$)/(pixel + strip hits) > 0.18
\item Vertex probability > 0.05
\end{itemize}

For $B^0_s$, since we expect it to have a $\phi$ resonance in the decay chain, we require the mass of the reconstructed dikaon candidate $|p_{K^+} + p_{K^-}| = m_{KK}$ to be 0.015 GeV/c$^2$ within the $\phi$ meson PDG mass ($m_\phi$ = 1.019455 GeV/c$^2$): $|m_{KK} - m_\phi| < 0.015$ GeV/c$^2$

\subsection{Muon Selections}

The muon candidates are selected according to the \textit{hybrid-soft muon} selection, developed for the muon analysis using CMS 2012 7 TeV $pp$ data \cite{SoftMuon}. It is adapted from the soft-muon ID developed in the BPH group, with two modifications: a) the purity selection is removed, and b) the muon is required to be also \textit{global}. This selection will be updated for the one developed in 2018. The \textit{hybrid-soft muon} selection includes the following cuts:


\begin{itemize}
\item Requirement to be Global Muon and Tracker Muon (described in section 3.4.3)
\item At least one good muons 
\item Transverse impact parameter $D_{xy}$ < 0.3 cm
\item Longitudinal impact parameter $D_{z}$ < 20 cm
\item At least 1 muon hits on pixel tracker layers and 5 hits on both the pixel + strip tracker layers 
\end{itemize}

In addition, an muon acceptance selection to ensure the muon candidate to have a total efficiency: $\epsilon^\mu > 10\%$. Table \ref{MuonAccCut} shows acceptance cuts, designed by the CMS muon analysis group, are also applied:

\begin{table}[h]
\begin{center}
\caption{Summary table of the muon acceptance selection for muon: $|\eta^\mu|$ as a function $p_T^\mu$.}
\vspace{1em}
\label{MuonAccCut}
  \begin{tabular}{ |c | c| c| c|}
    \hline 
Centrality &  $\langle N_{part} \rangle$ &$\langle N_{coll} \rangle$  & $\langle T_{AA} \rangle$  \\
     \hline
         \hline
 $|\eta^\mu|$ & 0 -- 1.2   & 1.2 -- 2.1  &  2.1 -- 2.4   \\
$p_T^\mu$ (GeV/c) &  > 3.5 &  > 5.47 - 1.89 & $\eta$  > 1.5   \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}

Table \ref{MuonAccCut} comes from the muon analysis in the 2018 PbPb dataset. Figure \ref{MuonAccPlot} shows the muon reconstruction, identification, and trigger efficiency as a function of $p_T^\mu$ and $\eta^{\mu}$ \cite{MuonAccRef}

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/MuonAccPbPb.pdf}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/MuonAccPP.pdf}
\caption{The total efficiency, including reconstruction, identification, and trigger, of a single muon in 2018 PbPb (left) and 2017 pp (right) are shown above. The black curve is the 2015 PbPb and pp 90\% muon efficiency boundary while the green curve is the 2017 pp and 2018 PbPb 90\% muon efficiency boundary. The green boundary is translated to numerical values in Table \ref{MuonAccCut}}
\label{MuonAccPlot}
\end{center}
\end{figure}

We should note that there is a discontinuity of the muon acceptance selection at $|\eta| = 1.2$. Aside from the single muon selections, the following selections are applied to the reconstructed dimuon candidates


\begin{itemize}
\item Two muons have opposite charges 
\item Two mouns are tracker muons
\item Dimuon invariant mass about 0.15 GeV/c$^2$ near the $J/\psi$ PDG mass ($m_{J/\psi}$ = 3.096916 GeV/c$^2$): $|m_{\mu\mu} - m_{J/\psi}| < 0.15$ GeV/c$^2$
\item One muon is L2 muon and the other one is L3 muon (described in section 2.25)
\item Probability of the two muon tracks to originate from the same decay vertex $>$ 1\%
\end{itemize}


In addition, a B-meson invariant mass window of $4 < m_B < 6$ GeV/c$^2$ is applied since the $B^0_s$ mass is $m_{B^0_s} = $ 5.367 GeV/c$^2$ and the $B^0_s$ mass is $m_{B^+} = $ 5,279 GeV/c$^2$ \cite{AlphaTheoEx}. Anything far away from the mass window should not be considered. After applying all these preliminary selections to improve the quality of our dataset for the analysis, we are ready to perform cut optimization to further reject background candidates based on the decay topology of the $B^0_s$ and $B^+$ decay chains.


\section{Cut Optimization} 


Given the high combinatorial background, particularly in PbPb collision where we have thousands of tracks per event \cite{PbPbMulti}, it is not possible to observe B-meson resonance by simply applying the preselection presented in the previous section. Figure \ref{} shows the invariant mass distribution of fully reconstructed $B^0_s$ and $B^+$ at $7 < p_T < 50$ GeV/c after the event, track, and muon selections.

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BsMassPreCut.eps}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPMassPreCut.eps}
\caption{The invariant mass distributions of fully reconstructed $B^0_s$ (left) and $B^+$ (right) after preselection are shown above.}
\label{MuonAccPlot}
\end{center}
\end{figure}


No B-meson signal is observed in the data. Therefore, aside from the preselections, a multivariate analysis (MVA) approach \cite{MVARef} is thus conducted in order to develop an optimal selection to separate signal B mesons from background and reconstruct a significant resonance in the invariant mass distribution in the data. The fitting performance is further related to both the amount of signal and background presented in the mass spectrum. 


\subsection{Topological Variables}


By an MVA analysis, one can then find the proper selection criteria which is optimized for this purpose. Several variables related to kaon tracks and B mesons decay topology are applied in order to reduce the combinatorial background that arises from random combination of tracks and muons. The topological variables used in B-meson analyses to be optimized by  are listed as follows:

\textbf{Topological Variables for $B^0_s$:}
\begin{itemize}
\item Kaon track $p_T$
\item Kaon track transverse distance to closest approach (DCA) significance: $DCA_{xy}/\sigma_{DCA_{xy}}$ 
\item Kaon track longitudinal distance to closest approach (DCA) significance: $DCA_{z}/\sigma_{DCA_{z}}$
\item Dikaon invariant mass distance to the $\phi$ meson PDG mass: $|m_{KK} - m_{\phi}|$
\item The $B^0_s$ meson decay length [or the distance between primary vertex (PV) and secondary vertex (SV)] significance: $|\vec{D}(SV,DV)|/|\sigma_{\vec{D}(SV,DV)}|$
\item The open angle between the B-meson decay length vector and its three momentum: $\alpha: \cos(\alpha) = \frac{\vec{D}(SV,DV) \cdot \vec{p}}{|\vec{D}(SV,DV)||\vec{p}|}$
\item The cosine angle of the opening angle in the transverse direction:  $\theta_B: \cos(\theta_B) = \frac{\vec{D(SV,DV)_{xy} \cdot \vec{p_T}}}{|\vec{D(SV,DV)_{xy}}||\vec{p_T}|}$
\item Vertex fitting probability: the $\chi^2$ value of the vertex fitting
\end{itemize}

For $B^+$, we also apply some addition rectangular selections before cut optimization

\textbf{Topological Variables for $B^+$:}
\begin{itemize}
\item Kaon track $p_T$
\item Kaon track $|\eta|$
\item Kaon track transverse distance to closest approach (DCA) significance: $DCA_{xy}/\sigma_{DCA_{xy}}$ 
\item The $B^+$ meson decay length [or the distance between primary vertex (PV) and secondary vertex (SV)] significance: $|\vec{D}(SV,DV)|/|\sigma_{\vec{D}(SV,DV)}|$
\item The open angle between the B-meson decay length vector and its three momentum: $\alpha: \cos(\alpha) = \frac{\vec{D}(SV,DV) \cdot \vec{p}}{|\vec{D}(SV,DV)||\vec{p}|}$
\item The cosine angle of the opening angle in the transverse direction:  $\theta_B: \cos(\theta_B) = \frac{\vec{D(SV,DV)_{xy} \cdot \vec{p_T}}}{|\vec{D(SV,DV)_{xy}}||\vec{p_T}|}$
\item Vertex fitting probability: the $\chi^2$ value of the vertex fitting
\end{itemize}

Figure \ref{DecayTopoBs} and \ref{DecayTopoBP} show the definition of topological variables of $B^0_s$ and $B^+$ decay chains respectfully 

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.98\textwidth]{Figures/Chapter4/BsDecay.png}
\caption{The definition of topological variables in the decay of $B^0_s \rightarrow J/\psi \phi \rightarrow \mu^+\mu^- K^+K^-$ (left) are schematically shown above.}
\label{DecayTopoBs}
\end{center}
\end{figure}


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.98\textwidth]{Figures/Chapter4/BPDecay.png}
\caption{The definition of topological variables in the decay of $B^+ \rightarrow J/\psi K^+ \rightarrow \mu^+\mu^- K^+ $ are schematically shown above.}
\label{DecayTopoBP}
\end{center}
\end{figure}

These topological variables will become the inputs to the multivariate analysis to optimize the signal significance.

\subsection{Multivariate Analysis}

In statistics, many data analysis techniques only focus on one or two variables individually. Multivariate analysis (MVA) analyzes more than two variables simultaneously to improve the data analysis. Figure \ref{MVADemo} shows schematically the advantages of MVA to traditional statistical techniques in data analysis to separate signal from background with two variables. 




\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/Rectangular.pdf}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/MVA.pdf}
\caption{The performance of traditional rectangular selection with a range of x and y (left) compared to the MVA method of a curve as a function of X and Y (right) are shown above. Here, we have the total signal S = 215 and the background B =  1000.}
\label{MVADemo}
\end{center}
\end{figure}

We can see that in multivariate analysis, an MVA value as a function of two independent variables $x$ and $y$: $MVA = f(x,y)$ is able to select signal out from background with higher purity (larger S/B ratio) than the rectangular selection function $x_1 < x < x_2$ and $y_1 < y < y_2$. Table \ref{MVAvsRec} shows the performance of MVA and traditional rectangular selections

\begin{table}[h]
\begin{center}
\caption{The comparison of the traditional rectangular selections to MVA for Figure \ref{MVADemo}.}
\vspace{1em}
\label{MVAvsRec}
  \begin{tabular}{ |c | c| c| c|}
    \hline 
Analysis Techniques &  S & B & S/B \\
     \hline
Rectangular & 174 & 135 & 1.29  \\
         \hline
MVA &   215  & 114  & 1.89  \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}


\subsection{Machine Learning Techniques}

Machine learning, as branch of artificial intelligence, is the science that gets the computers to learn what human beings do. It is an automating data analysis method for model building to solve practical problems. Figure \ref{MLProblem} demonstrates the data analysis problems including classification, regression, and clustering, where machine learning could be applied.

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.85\textwidth]{Figures/Chapter4/MLProblemsNew.png}
\caption{The solutions to classification, regression, and clustering problems with supervised and unsupervised machine learning approaches are shown schematically above.}
\label{MLProblem}
\end{center}
\end{figure}

In this analysis, our goal is to separate B meson signal out of the background. Therefore, it is a classification problem. Therefore, machine learning can be a power tool to solve our problems. We apply supervised machine learning to train the computer and let them find the optimal selections for B-meson analyses.   


\subsection{Terminologies}

The following list explains the technical jargons of machine learning techniques along with MVA that may be mentioned later in this thesis:


\begin{itemize}
\item \textbf{Training samples:} the input samples including both background and signal to train the computer. In this thesis, we use the B mesons candidates coming from our chosen B-meson decay channels (GEN Matched) in MC as the signal input and the B mesons candidates from the invariant mass sideband region with a distance of greater than 0.2 GeV/c$^{2}$ to the PDG mass of B mesons as background input to the \textit{TMVA} 
\item \textbf{Testing samples:} the samples including both background and signal going to be tested with the output from the training. The testing sample should not be the same as the training sample.
\item \textbf{Correlation matrix:} the linear correlation between the input variables for training 
\item \textbf{ROC curve:} the curve of signal efficiency as a function of the background rejection (= 1 $-$ background efficiency) for a given MVA value. Here the efficiency is defined as: efficiency = the number of candidates with the given MVA cut/ number of candidates without the MVA cut.
\item \textbf{Overtraining:} A Kolmogorov-Smirnov test \cite{KSTest} to compare the shape of the MVA distributions of training and test samples. It returns probabilities for both signal and background between 0 and 1. The closer to 0, the poor the matching, the more the overtraining will be.  
\end{itemize}


Figure \ref{SigBackRegion} shows the definition of signal and background regions in $B^0_s$ and $B^+$ invariant mass plot. 

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BsData.png}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPData.png}
\caption{The definitions of signal (red band) and background region (blue band) in the fully reconstructed B-meson invariant distribution for $B^0_s$ (left) and $B^+$ (right) are shown above.}
\label{SigBackRegion}
\end{center}
\end{figure}

The signal region is $|m_B - m_B^{PDG}| < 0.08$ GeV/c and the background region is $0.20 < |m_B - m_B^{PDG}| < 0.30$ GeV/c$^2$ for $B^0_s$ and $0.15 < |m_B - m_B^{PDG}| < 0.25$ GeV/c$^2$  for $B^+$.


\subsection{Boosted Decision Tree Algorithm}

Nowadays, machining learning has become sophisticated. There are many well developed machining learning algorithms such as Rectangular Cut (CutsSA) Linear Discriminant (LD), Boosted Decision Tree (BDT), neutral network feed-forward Multilayer Perceptrons with recommended ANN with BFGS training method and bayesian regulator (MLPBNN), and Deep Learning in the market. Here, I will give a brief introduction about BDT algorithm in terms of \textit{Boosted} and \textit{Decision Tree}

\textbf{Boosted:} Boosted here refers to the ``boosting'' factor $\alpha$ in the hypothesis function to let the machine learn and correctly model the actual curve \cite{BoostingRef}. According to supervised machine learning, in order to use the boosting method, we first assign an ensemble of many weak learners to create of a strong learner. The idea of boosting is to keep reweighing the function to enhance the classification and regression and performance by applying an MVA algorithm subsequently to the reweighed version of the training data in a sequential matter. Eventually, the hypothesis will converge a function that can describe the actual data. Figure \ref{Boosting} below shows schematically the boosting scheme 


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.85\textwidth]{Figures/Chapter4/Boosting.jpg}
\caption{The schematic illustration of boosting procedures in machine learning is shown above.}
\label{Boosting}
\end{center}
\end{figure}


\textbf{Decision Tree:} A decision tree, sometime called as a regression tree, is a binary decision support tool using a tree-like model of decisions and list their possible consequences. Starting from a sampling to analyze, it sets up criteria for selections to decide the likelihood of signal and background based on the pure signal and background input samples. Then, it makes binary decisions (Yes/No), in each branch to select subset of samples out of the current sample, can be in sequentially or in parallel. It will then iterate multiple times until the sub samples are considered as signal or background. In TMVA machinery, the number of iteration is called \textit{NTree}. Figure \ref{DecisionTree} is a schematic demonstration of a decision tree with NTree = 4

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.85\textwidth]{Figures/Chapter4/DecisionTree.pdf}
\caption{The schematic block diagram of a binary decision tree with NTree = 4 to separate signal and background in a training sample.}
\label{DecisionTree}
\end{center}
\end{figure}

In general, the performance of BDT will improve as NTree become larger. However, we should note that normally NTree is required to be smaller than the sample statistics. Otherwise, overtraining may occur and could induces bias in the data analysis. We should note that the BDT score range from -1 to 1. 



\subsection{TMVA Training}


To perform machine learning, I use the Toolkit for Multivariate Data Analysis with ROOT (\textit{TMVA}) \cite{TMVA}, a dedicated ROOT base machine learning software framework on C++ programing language, to train the computer to find the optimal MVA value as a function of the topological variables in our B-meson analyses. We propose to optimize $B^0_s$ in the $p_T$ binning of [7, 10, 15, 20, 50] GeV/c and $B^+$ in the $p_T$ binning of [5, 7, 10, 15, 20, 30, 40, 50, 60] individually. The following procedures are carried out:

Step 1: identify sufficient signal and background samples to train the computer within \textit{TMVA} machinery. 

Step 2: choose the training algorithms to use. Here, we choose CutsSA, CutsGA, BDT, MLP, and MLPBNN2 algorithms

Step 3: decide the training parameters for the each training algorithm. 

Step 4: run the TMVA machinery and generate the performance plots 

Step 5: choose the best algorithm according to the performance


\subsection{Training Performance}

After finishing the TMVA training procedure, we are ready to look at the training performance. First, we the correlation between the input topological variables. Figure \ref{CorrMatrix} shows the correlation matrices of $B^0_s$ and $B^+$ topological variables for B-meson $10 < p_T < 15$ GeV/c.

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BsCorr_10_15.eps}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPCorr_10_15.pdf}
\caption{The correlation matrices of $B^0_s$ (left) and $B^+$ (right) in data at $10 < p_T < 15$ GeV/c are shown above.}
\label{CorrMatrix}
\end{center}
\end{figure}

We can see that there are no significant correlation among the topological variables except the open angle $\alpha$ and the cosine its transverse projection $ \cos\theta$, which is know. Therefore, the variable sets we input to the \text{TMVA} training are good.  

Next we compare the overall performance among the algorithms. Figure \ref{ROCAll} below shows the ROC curves for $B^0_s$ \textit{TMVA} training at 10 $< p_T < $ 15 GeV/c.

\begin{figure}[h]
\begin{center}
%\includegraphics[width= 0.80\textwidth]{Figures/Chapter4/BsROC.png}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPOT.pdf}
\caption{The $B^0_s$ ROC curves of CutsSA, CutsGA, BDT, MLP, and MLPBNN2 algorithms are shown above.}
\label{ROCAll}
\end{center}
\end{figure}

We should note that the number of tree for BDT here is NTree = 2000. From Figure \ref{ROCAll}, we can see that BDT has the best performance compared to other algorithms in the given parameter settings. Basically, for a given background rejection, the BDT curve has the highest signal efficiency. It is closer to the upper right corner, which is the perfect algorithm. Therefore, we decide to use BDT algorithm to look for the optimal selections in all $p_T$ bins in both $B^0_s$ and $B^+$ analysis.


Finally, before, implementing the BDT algorithm to the analysis, we also check the overtraining and make sure that no significant overtraining is observed. Figure \ref{OverTraining} show the overtraining test for both $B^0_s$ and $B^+$ BDT at 10 $< p_T < $ 15 GeV/c. 


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BsOT.eps}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPOT.pdf}
\caption{The Kolmogorov-Smirnov overtraining tests on the signal (blue) and background (red) in $B^0_s$ (left) and $B^+$ (right) at $10 < p_T < 15$GeV/c are shown on the right. It looks like they both pass the tests.}
\label{OverTraining}
\end{center}
\end{figure}

According to Figure \ref{OverTraining}, neither signal nor background of $B^0_s$ and $B^+$ BDT is vanishing. Hence, no significant overtraining is observed. The BDT trainings are valid to use in the $B^0_s$ and $B^+$ analysis.


\subsection{Working Point Determination}

Now with the BDT training results, next step is to choose the BDT selection that can give us the best analysis results. We decide to use the statistical significance, which is as follows

\begin{equation}
Sig = \frac{S}{\sqrt{S+B}}
\end{equation}

as the figure of merit. We estimate $S$ and $B$ for set of BDT cuts and choose BDT score that return to the maximum statistical significance in each $p_T$ bin. We can directly estimate the background $B$ according to the data sideband region width scaled to the signal region band width

\begin{equation}
B = \frac{w_{S}}{w_{B}} N_{B} \epsilon_{B}
\end{equation}

To determine the signal $S$, we do not directly look at the data. Instead, we use FONLL cross section \cite{FONLLRef} shown in \ref{FONLL} and the MC to determine the signal $S$ as follows

\begin{equation}
S = 2 R_{AA}^{2015Ref} L \sigma_{FONLL}^{pp\rightarrow b\bar b} \epsilon_{pre} \epsilon_{S} f(b\rightarrow B) BR
\end{equation}

According to our calculations, for $B^0_s$ at $10 < p_T < 15$ GeV/c, before the BDT selections, S = 47 and B = 20672. Now, we scan through a series of BDT values from -1 to 1 and compute their corresponding statistical significance. Figure \ref{WorkingPoint} shows the statistical significance as a function of BDT for $B^0_s$ and $B^+$ at $10 < p_T <  15$ GeV/c

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BsSig_10_15.pdf}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/BPSig_10_15.pdf}
\caption{The significance: $Sig = \frac{S}{\sqrt{S+B}}$ as a function of BDT in $B^0_s$ at $10 < p_T <  15$ GeV/c are shown above. We can see that $B^0_s$ BDT peaks near 0.32 while $B^+$ peaks near 0.09.}
\label{WorkingPoint}
\end{center}
\end{figure}

For $B^0_s$  Our optimal selection returns us with an S = 38 and B = 5, which has a remarkable background-to-signal rejection of more than $10^3 : 1$.



Table \ref{BsSig} and \ref{BPSig} documents the optimal BDT selections maximizing the statistical significance in each $p_T$ bin for $B^0_s$ and $B^+$ respectfully.

\begin{table}[h]
\begin{center}
\caption{The summary of optimal BDT selection maximizing the $B^0_s$ statistical significance.}
\vspace{1em}
\label{BsSig}
  \begin{tabular}{ |c | c| c| c| c|}
    \hline 
$B^0_s$ $p_T$ (GeV/c) & 5 -- 10 & 10 -- 15 & 15 -- 20 &  20 -- 50\\
     \hline
 BDT Cut Values & $>$ 0.32 & 0.29  & 0.35 & 0.33  \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
\caption{The comparison of the traditional rectangular selections to MVA for Figure \ref{MVADemo}.}
\vspace{1em}
\label{BPSig}
  \begin{tabular}{ |c | c| c| c| c| c| c| c| c|}
    \hline 
$B^+$ $p_T$ (GeV/c) & 5 -- 7 & 7 -- 10 & 10 -- 15 & 15 -- 20 & 20 -- 30 & 30 -- 40 & 40 -- 50 & 50 -- 60\\
     \hline
 BDT Cut Values & $>$ 0.02  & 0.03  & 0.09 & 0.07  & 0.10 & 0.16 & 0.20 & 0.27  \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}


\subsection{Optimal Selection Performance}

To check the performance BDT selections, we look at the dimuon and dikaon invariant mass distributions to see if $J/\psi$ and $\phi$ resonance are observed. Figure \ref{mesonpeak} shows the after apply the selections


\begin{figure}[h]
\begin{center}
\includegraphics[width=0.42\textwidth]{Figures/Chapter4/mc_PbPb_1_Bmumumass.pdf}
\includegraphics[width=0.42\textwidth]{Figures/Chapter4/mc_PbPb_1_Btktkmass.pdf}
\includegraphics[width=0.42\textwidth]{Figures/Chapter4/data_PbPb_1_Bmumumass.pdf}
\includegraphics[width=0.42\textwidth]{Figures/Chapter4/data_PbPb_1_Btktkmass.pdf}
\caption{The $J/\psi$ (left) and $\phi$ (right) meson mass distributions after applying BDT > 0 for MC (top) and data (low) in $B^0_s$ analysis are shown above.}
\label{mesonpeak}
\end{center}
\end{figure}

We can see clear $J/\psi$ and $\phi$ peaks after apply the selections in both data and MC, which suggests that our selections are reasonable. Now we can also look at the invariant mass distributions of $B^0_s$ and $B^+$ in Figure \ref{Bpeaks}

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.42\textwidth]{Figures/Chapter4/BsMassBDTCut.eps}
\includegraphics[width=0.42\textwidth]{Figures/Chapter4/BPMassBDTCut.eps}
\caption{The $B^0_s$ (left) and $B^+$ (right) invariant mass distributions after applying optimal BDT selections from $10 < p_T < 50$ GeV/c in data are shown above.}
\label{Bpeaks}
\end{center}
\end{figure}

Again, we can see very clear signal after the optimal BDT selections in both $B^0_s$ and $B^+$. Now we are ready to study its background and signal before extracting the raw yield for B-meson cross section measurement.

\section{Background Studies} 

\subsection{Overview}

The production of $J/\psi$ mesons occurs in three ways. The prompt $J/\psi$ produced directly in the proton-proton collision or indirectly via the decay of heavier charmonium states, and non-prompt $J/\psi$ from the decay of a b hadron. Non-prompt $J/\psi$ lead to a measurement of the b-hadron cross section. According to PDG, so far physicists have observed thousands of known decay modes of b hadrons \cite{AlphaTheoEx}. Without hadronic PID, we can envision that there are potential background feed-down sources coming from other B meson decays in the B-meson invariant mass spectrum. For instance, the decay of $B^0 \rightarrow J/\psi K^{*0} (892) \rightarrow \mu^+ \mu^- K\pi$ could contribute to the $B^0_s \rightarrow J/\psi \phi \rightarrow \mu^+ \mu^- K^+ K^-$ due to misidentification of $\pi$ to $K$. We call such background as ``non-prompt (NP) background'', to distinguish them from the combinatorial background due to random combination of decay daughters when reconstructing B mesons. NP background generally form a peaking structure in the region of interests. A dedicated inclusive NP $J/\psi$ from b hadron decay MC is simulated to determine NP background component near our B meson invariant mass region. We then classify each reconstructed B-meson candidate by their GEN-level particle, e.g. whether it is coming from a $B^{0}$, $B^{+}$ or other decays that falls into the B-meson reconstruction work flow, in order to measure their individual contribution to the peaking structure.


\subsection{Individual Channel NP Background Studies} 


\label{sec:individual_channels}
There are many small contributions that gives the form to the peaking background structure. We can not identified each of them individually but most of the contributed ones are determined.
Below is a list of example processes that compose of the majority of the peaking background:

\begin{itemize}
\item {Case 1: $ X \rightarrow J/\psi  \pi^{-}  K^{+}$, here pion is mis-identified as kaon}
\item {Case 2: $ B_{s}^{0} \rightarrow J/\psi  K^+ K^- $, in which both Kaons are not coming from the decay of an intermediate $\phi$ meson resonance.}
\item {Case 3: $ B^{+} \rightarrow J/\psi  K^{+}$, (added extra $K^-$)} 
\item {Case 4: $ X \rightarrow J/\psi  \pi^{+} \pi^{-}$, pions mis-identified as Kaons. }
\item {Case 5: $ B_{s}^{0} \rightarrow J/\psi K^{+} K^{-} X $ }
\item {Case 6: $ B_{s}^{0} \rightarrow J/\psi \phi \pi \pi $}
\item {Case 7: $B^0 \rightarrow J/\psi  K^{*0} $}
%\item {8 th case $ \chi_{1c} \rightarrow J/\psi \gamma$ }
%\item {9 th case $ \psi_{2s} \rightarrow J/\psi  X $}
\end{itemize}

Figure \ref{BsNPbkgd} shows the contribution of the determined channels with respect to the total background after applying optimal cuts for PbPb for 10 $< p_T <$ 15 GeV/c, 10 $< p_T <$ 20 GeV/c, 20 $< p_T <$ 50 GeV/c, as well as the inclusive 10 $< p_T <$ 50 GeV/c. The peak at the $B_{s}^{0}$ signal region has been investigated and found out that mostly contributed channels are $B^0 \rightarrow J/\psi  K^{*0} (892)$ in grey color and $ B_{s}^{0} \rightarrow J/\psi  K^{+} K^{-}$ in black color. 


\begin{figure}[ht!]
\centering
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackgroundONLY_0.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackgroundONLY_1.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackgroundONLY_2.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackgroundONLY_3.png}
\caption{Individual NP background contributions with respect to the total background components for 10 to 15 GeV (top left), 15 to 20 GeV (top right), 20 to 50 GeV (bottom left), and 10 to 50 GeV (bottom right) for PbPb sample. We can see that the non-prompt background from all channels listed above are negligible compared to the inclusive background. Also, the no peak near the $B_s$ resonance is observed when the inclusive background subtract the $B^0 \rightarrow J/\psi  K^{*0} $ and $B_s \rightarrow J/\psi  K^+ K^-$ components.}
\label{BsNPbkgd}
\end{figure}


Figure \ref{BsNPBS} also includes the signal component in the distribution. We can see that the non-prompt background is insignificant compared to the total inclusive background and the inclusive background is low comparing to the $B_s \rightarrow J/\psi \phi \rightarrow J/\psi K^+ K^-$ signal in our studies.
 
 
 
 \begin{figure}[ht!]
\centering
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackground_0.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackground_1.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackground_2.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/NPBackground_3.png}
\caption{Individual Non Prompt background contributions with respect to the total background components and the signal channel for 10 to 15 GeV (top left), 15 to 20 GeV (top right), 20 to 50 GeV (bottom left), and 10 to 50 GeV (bottom right) for PbPb sample. We can see that the inclusive background is small compared to the signal we used in our studies.}
\label{BsNPBS}
\end{figure}
 
 
\subsection{B meson contribution of NP Background to $B^0_s$}


From the non-prompt background studies above, we can see that there are many small contributions. Those small components together summed up constructing a large background and we can not identify all of them individually. Under this circumstances, another definition of individual component defined. The new definition of the NP background components are listed below;

\begin{itemize}
\item {Case 1: $ B^{+} \rightarrow J/\psi X $, all contribution from B+}
\item {Case 2: $ B_{s}^{0} \rightarrow J/\psi X $ , all contribution from $ B_{s}^{0} $ }
\item {Case 3: $ B^{0} \rightarrow J/\psi X$, all contribution from $ B^{0}$}
\item {Case 4: Other contributions}
\end{itemize}

In Figure \ref{BMesonNPCon} the signal region is dominated by the $B^{0}$, $B^{+}$, and $B_{s}^{0} $ decays while the other channels are contributed on the left side of the mass spectrum. For both pp and PbPb data, the $B^{0}_{s} $ to $J/\psi$ + X  (orange region) makes a big contribution.

\begin{figure}[ht!]
\centering
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/BmesonBackground_0.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/BmesonBackground_1.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/BmesonBackground_2.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/BmesonBackground_3.png}
\caption{ $B^{+}$, $B_{s}^{0} $, $ B^{0}$ channels make nearly equal contribution in the signal region for all $p_T$ bins 10 - 15 GeV/c, 15 - 20 GeV/c, 20 - 50 GeV/c, and 10 - 50 GeV/c.}
\label{BMesonNPCon}
\end{figure}

 

The conclusion is that the NP peaking background contribution to the $B^0_s$ is negligible due to the $K^{*0} (892)$ veto cut: $|m_{KK} - m_\phi| < 0.015$ GeV/c$^2$. We estimate that it may only contribute around 4\% uncertainties to the signal yield, which is negligible compared to the statistical uncertainties of the $B^0_s$ signal, which is on the order of 10\%. Hence, there is no need to develop a specific function to model the NP background component for $B^0_s$.


\subsection{B meson contribution of NP Background to $B^+$}

We veto the candidates from the inclusive NP $J/\psi$ MC sample that are matched to a genuine $B^+$ signal. The resulting B candidate mass spectrum in the inclusive $p_T$ range (5-100 GeV/c) is shown in Figure \ref{NPBP} for PbPb MC samples. 

It is clear that these sources create a peaking structure in the region of $\rm M_{inv}<$5.20 GeV/c$^2$ as seen in Figure \ref{Bpeaks} after applying the optimal selection. This structure can be nicely fit with an error function as done previously in B proton-proton analyses \cite{CMSBPH}. In addition, there is a minor peak on the right shoulder ($\approx$5.34 GeV/c$^2$) of the nominal signal ($\approx$5.28 GeV/c$^2$), and this can be fit with an Gaussian function. There is additional combinatorial background which is fitted with a linear function. This contribution is absorbed in the total combinatorial background of our nominal channel of the main analysis. This will be described in details in Section 4.6. The shape of the NP background model function is used as template in the fit extraction procedure. 

Further MC studies have been done in order to identify the different channels that give rise to the non-prompt peaking structure in the $B^+$ invariant mass spectrum. Several main processes have been identified as follows:

\begin{itemize}
\item Case 1: 4-body $B^+$ decays which occur via resonant decay channels e.g. $B^+\rightarrow J/\psi K^{*+}(892)$. In these cases, we distinguish the kaons coming from the $K^{*+}(892)$ decays as coming from a signal $B^+\rightarrow J/\psi~K^+$ decay. 
\item Case 2: 4-body $B^0$ decays channels e.g. $B^0\rightarrow J/\psi K^{*0}(892)$.
\item Case 3: $B^+\rightarrow J/\psi\pi^+$ decays in which we have misidentified the $\pi^+$ as a $K^+$.
\end{itemize}

The different contributions in PbPb are presented in Fig.\ref{BPNPPeak}.
The contribution from $B^+\rightarrow J/\psi \pi$ clearly form a peaking structure on the right shoulder of the nominal decay channel $B^+$ decay. However, the overall magnitude of this component is tiny compared to the other two sources, and negligible compared to the nominal signal. As a consequence, we can barely see the contribution of this peaking structure in the invariant mass plot of $B^+$ nominal channel.

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/fitNP_PbPb.pdf}
\caption{$B^+$ candidate mass spectrum obtained in inclusive B meson MC production after vetoing the contribution of genuine $B^+$ signal candidates in PbPb.}
\label{NPBP}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BmassBpPi.pdf}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BmassBpK_tkmatch.pdf}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BmassB0K_tkmatch.pdf}
\caption{Peaking background contribution from $B^+\rightarrow J/\psi \pi$ and from K resonant decay channels of $B^0$ and $B^+$ in PbPb MC.}
\label{BPNPPeak}
\end{center}
\end{figure}

The conclusion from these studies is that we need to use a function to model the NP background component. Its template shape should be determined according to the $B^+$ NP MC sample and applied to the data with a scale parameter. According to our studies, such function is the error function in the left hand shoulder (low than the $B^+$ PDG mass) and a double Gaussian in the $B^+$ signal region.

\section{Signal Extraction} 

Now, equipped with the optimal selection and the NP background studies, we are ready to extract the signal raw yield from the B-meson invariant distribution and measure the cross section. Also, since we see very clear $B^0_s$ signal, we can estimate the $B^0_s$ significance and check if there will be an observation.

\subsection{Fitting Models}

Raw yields are extracted through extended unbinned maximum likelihood fits to the invariant mass of reconstructed $B^0_s$ meson candidates, performed using the \textit{Roofit} package \cite{ROOFIT}. The unbinned fit can reduce the potential bias due to the binning artifact. We develop the probability density function (PDF) to fit to the B-meson invariant mass distributions to extract their signal raw yields. In the PDF, the signal region for both $B^0_s$ and $B^+$ are described by Gaussian functions with the same means but different widths and the combinatorial background is modeled with an exponential decay function. For $B^+$, an additional error function in the left hand shoulder (low than the $B^+$ PDG mass) and a double Gaussian in the $B^+$ signal region to fit NP background according to the template fits to inclusive NP $J/\psi$ MC sample in Section 4.7. 

Hence, the generic event likelihood in data is described by the formula below

\begin{equation}
{\cal{L}}(m;N_S) = N_S \cdot (\alpha G(m;M,\sigma_1) + (1-\alpha) G(m; M,\sigma_2))+ N_B \cdot E(m;\lambda_m)
\end{equation}

\begin{equation}
G(m;M,\sigma) = \frac{1}{\sqrt{2\pi}\sigma} \exp^{-\frac{(m-M)^2}{2\sigma^2}}
\end{equation}

\begin{equation}
E(m;\lambda_m) = \exp^{-\lambda_m m}
\end{equation}

Where $m$ is the candidate mass (input); $M$ and $\sigma_i$ are the signal mass mean and widths (resolution); $G$ and $E$ denote respectively Gaussian and Exponential functions, normalized in the fitting mass window; $N_S$ denotes the signal raw yield (the parameter of interest),  $N_B$ is the background yield, while $\alpha$ and $\lambda_m$ are nuisance parameters (describing the signal fractions and exponential decay slope). %As mentioned already, $\alpha$, $\sigma_1$ and $\sigma_2$ are fixed from the MC fit.

It should note that the main reason for using double Gaussian functions instead of a single Gaussian is that the reconstructed $B^0_s$ signal width varies as a function of B-meson $pT$ due to the $p_T$ dependence of the track $p_T$ resolution. Figure \ref{BsBPWidthPT} shows the $B^0_s$ and $B^+$ invariant mass width as a function of $p_T$ in the MC


\begin{figure}[ht!]
\centering
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/BmesonBackground_0.png}
\includegraphics[width=0.45\linewidth]{Figures/Chapter4/BmesonBackground_1.png}
\caption{The signal $B^0_s$ (left) and $B^+$ (right) invariant mass width as a function of $p_T$ are shown above.}
\label{BsBPWidthPT}
\end{figure}


\subsection{Raw Yield Extraction}


To obtain the signal raw yields and their statistical uncertainties from $B^0_s$ and $B^+$ invariant mass distribution, the following fitting procedures are carried out within B-meson invariant mass window $5 < m < 6$ GeV/c$^2$.

\begin{itemize}
\item First, a fit is performed, with a double gaussian function to the MC invariant mass distribution of the genuine B-meson signals.
\item For $B^+$, the shape of the non-prompt background component is obtained using the dedicated non-prompt $J/\psi$ MC samples.
\item The fit is performed to the data with the fixed the shape (widths and relative proportion of the two Gaussians) same with the Gaussians obtained from the MC fit.
\item For systematic uncertainty check, add a free parameter ($a$), that is commonly multiplied to the widths of the signal Gaussians, serving as a scale factor of the resolution that parametrizes data and MC signal shape difference. However in the nominal fit, this is set to be unity ($a = 1$), which means the widths of the data signal are set to be identical to the ones of the MC signal.
\item The parameters of the background PDF, the mean of the signal Gaussians are the free parameters of the fit.
\end{itemize}

% First, the fit is performed to the MC invariant mass distribution to obtain the two double Gaussian width parameters $\sigma_1$ and $\sigma_2$ as well as the relative proportion $\alpha$ describing the signal. Then, the fit is performed to the reconstructed B-meson invariant mass distribution in data, fixing the values of the $\sigma_1$ and $\sigma_2$ and the relative proportion $\alpha$ between the two gaussians to the value obtained from the MC fit. The mean of the Gaussian is treated as a floating parameter. The background components, including the NP peaking background and combinatorial background, are also determined according to the fit.

Figure \ref{BsMassPt} shows the fitting results of $B^0_s$ in the $p_T$ range of [7, 10, 15, 20, 50] GeV/c.  


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_BptNew_710_doubly0_0_90EffInfoTreeFit.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_2_BptNew_1015_doubly0_0_90EffInfoTreeFit.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_3_BptNew_1520_doubly0_0_90EffInfoTreeFit.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_4_BptNew_2050_doubly0_0_90EffInfoTreeFit.pdf}
\caption{The $B^0_s$ invariant mass distributions as well as the fits to extract the signal raw yield $N_{S}$ in different $p_T$ bins are shown above.}
\label{BsMassPt}
\end{center}
\end{figure}

Figure \ref{BsMassCent} shows the fitting results of $B^0_s$ in the centrality range of [0, 30, 90] in PbPb collisions.  

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_BptNew_1050_doubly0_0_30EffInfoTreeFit.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_BptNew_1050_doubly0_30_90EffInfoTreeFit.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_BptNew_1050_doubly0_0_90EffInfoTreeFit.pdf}
\caption{The $B^0_s$ invariant mass distributions as well as the fits to extract the signal raw yield $N_{S}$ in different centrality bins are shown above.}
\label{BsMassCent}
\end{center}
\end{figure}

Figure \ref{BPMassPt} shows the fitting results of $B^+$ in the $p_T$ range of [7, 10, 15, 20, 50] GeV/c.  


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_Bpt_710_doubly0_0_90_ntKp.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_2_Bpt_1015_doubly0_0_90_ntKp.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_3_Bpt_1520_doubly0_0_90_ntKp.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_4_Bpt_2050_doubly0_0_90_ntKp.pdf}
\caption{The $B^+$ invariant mass distributions as well as the fits to extract the signal raw yield $N_{S}$ in different $p_T$ bins are shown above.}
\label{BPMassPt}
\end{center}
\end{figure}

Figure \ref{BPMassCent} shows the fitting results of $B^0_s$ in the centrality range of [0, 30, 90] in PbPb collisions.  

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_Bpt_1050_doubly0_0_30_ntKp.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_Bpt_1050_doubly0_30_90_ntKp.pdf}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/data_PbPb_1_Bpt_1050_doubly0_0_90_ntKp.pdf}
\caption{The $B^+$ invariant mass distributions as well as the fits to extract the signal raw yield $N_{S}$ in different centrality bins are shown above.}
\label{BPMassCent}
\end{center}
\end{figure}

Table \ref{BsRawYield} and \ref{BPRawYield} below summarize the selected fit parameters and their error extracted from the fits of $B^0_s$ and $B^+$ respectfully



\begin{table}[h]
\begin{center}
\caption{The summary table of $B^0_s$ fits results of Gaussian mean, signal raw yield, and background raw yield as well as their uncertainties.}
\vspace{1em}
\label{BsRawYield}
  \begin{tabular}{ |c|c|c|c|c|}
    \hline 
Centrality (\%) & $B^0_s$ $p_T$ (GeV/c) & Gaus Mean (GeV/c$^2$) & Sig Yield ($N_S$) & Bkgd Yield ($N_B$) \\
     \hline
0 -- 90 & 7 -- 10 & 5.386 $\pm$ 0.007 & 5.94 $\pm$ 2.43 & 1.06 $\pm$ 1.03 \\
0 -- 90 & 10 -- 15 & 5.368 $\pm$ 0.003 & 23.41 $\pm$ 5.28 & 35.59 $\pm$ 6.28 \\
0 -- 90 & 15 -- 20 & 5.369 $\pm$ 0.002 & 26.70 $\pm$ 5.31 & 16.33 $\pm$ 4.20 \\
0 -- 90 & 20 -- 50 & 5.371 $\pm$ 0.003 & 30.19 $\pm$ 5.73 & 16.82 $\pm$ 4.39 \\
0 -- 30 & 10 -- 50 & 5.369 $\pm$ 0.002 & 54.64 $\pm$ 7.86 & 60.35 $\pm$ 8.19 \\
30 -- 90 & 10 -- 50 & 5.370 $\pm$ 0.003 & 29.88 $\pm$ 5.58 & 10.13 $\pm$ 3.37 \\
0 -- 90 & 10 -- 50 & 5.369 $\pm$ 0.002 & 80.25 $\pm$ 9.43 & 68.74 $\pm$ 8.79 \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}


\begin{table}[h]
\begin{center}
\caption{The summary table of $B^+$ fits results of Gaussian mean, signal raw yield, and background raw yield as well as their uncertainties.}
\vspace{1em}
\label{BPRawYield}
  \begin{tabular}{ |c|c|c|c|c|}
    \hline 
Centrality (\%) & $B^+$ $p_T$ (GeV/c) & Gaus Mean (GeV/c$^2$) & Sig Yield ($N_S$) & Bkgd Yield ($N_B$) \\
     \hline
0 -- 90 & 7 -- 10 & 5.277 $\pm$ 0.004 & 92.33 $\pm$ 10.88 & 7.90 $\pm$ 2.33 \\
0 -- 90 & 10 -- 15 & 5.279 $\pm$ 0.001 & 354.6 $\pm$ 20.68 & 39.9 $\pm$ 6.28 \\
0 -- 90 & 15 -- 20 & 5.279 $\pm$ 0.001 & 26.70 $\pm$ 5.31 & 16.33 $\pm$ 4.20 \\
0 -- 90 & 20 -- 50 & 5.278 $\pm$ 0.001 & 30.19 $\pm$ 5.73 & 16.82 $\pm$ 4.39 \\
0 -- 30 & 10 -- 50 & 5.278 $\pm$ 0.001 & 657.7 $\pm$ 27.7 & 53.46 $\pm$ 5.28 \\
30 -- 90 & 10 -- 50 & 5.281 $\pm$ 0.001 & 327.0 $\pm$ 19.5 & 19.57 $\pm$ 4.69 \\
0 -- 90 & 10 -- 50 & 5.279 $\pm$ 0.001 & 971.6 $\pm$ 33.9 & 74.16 $\pm$ 6.91 \\
     \hline
 \end{tabular}
\end{center}
\end{table}

At a glance, we can see that our fits looks good. In addition to the fits, the pull, defined as the ratio of the difference between the data and the fit to the statistical uncertainties of the data, are also shown above in Figure \ref{BsMassPt,BsMassCent,BPMassPt,BPMassCent}. We can see that the pull is basically consistent with 0 with a 2 $\sigma$ fluctuation, which suggests that our fit also looks good. A dedicated closure test on the fits will be conduct later to further validate our fits.

\subsection{Signal Significance Estimation}

The significance (Z) is calculated through a likelihood method, which follows the formula below:

\begin{equation}
Z=\sqrt{ 2 \log \frac{L_{S+B}}{L_B}}
\end{equation}

Here, $L_{S+B}$ is the likelihood of each fit and $L_B$ is the likelihood when the number of signal $N_S$ parameter is fixed to 0. Figure \ref{BsSigScan} show the likelihood scan of $B^0_s$ in 4 $p_T$ bins and 3 centrality bins

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/sigscan_0_90_7_10.png}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/sigscan_0_90_10_15.png}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/sigscan_0_90_15_20.png}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/sigscan_0_90_20_50.png}
\caption{The significance vs signal yield for $p_T$ bins at 7 -- 10, 10 -- 15, 15 -- 20, and 20 -- 50 GeV/c for 0 - 90\% centrality are shown above}
\label{BsSigScan}
\end{center}
\end{figure}


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/sigscan_0_30_10_50.png}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/sigscan_30_90_10_50.png}
\includegraphics[width= 0.45\textwidth]{Figures/Chapter4/sigscan_0_90_10_50.png}
\caption{The significance vs signal yield for centrality bins in 0 - 30\%, 30\% - 90\% 0 - 90\% for $p_T$ in 10 - 50 GeV/c are shown above}
\label{fig:SigScanCent}
\end{center}
\end{figure}



Table \ref{BsSig} summarizes the significance of $B^0_s$ according to our likelihood estimation.



\begin{table}[h]
\begin{center}
\caption{The summary table of $B^0_s$ likelihood significance for each $p_T$ and centrality bin.}
\vspace{1em}
\label{BsSig}
  \begin{tabular}{ |c|c|c|}
    \hline 
Centrality (\%) & $B^0_s$ $p_T$ (GeV/c) & Likelihood Significance (Z)  \\
     \hline
0 -- 90 & 7 -- 10 & 5.3 \\
0 -- 90 & 10 -- 15 & 7.9 \\
0 -- 90 & 15 -- 20 & 10 \\
0 -- 90 & 20 -- 50 & 10 \\
0 -- 30 & 10 -- 50 &  14 \\
30 -- 90 & 10 -- 50 &  11\\
0 -- 90 & 10 -- 50 & 16 \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}



We can see that $B^0_s$ have significances of greater than 5$\sigma$ for all its $p_T$ and centrality bins. In fact, this is the first observation of fully reconstructed $B^0_s$ meson in nucleus-nucleus collision with greater than 5$\sigma$ significance. 

\section{B Mesons Candidates MC-Data Comparison}

Ideally, if the simulation is impeccable, the RECO distribution in the MC should match perfectly with data. Nevertheless, there is always limitation in the MC simulation because the incorrect model of physics processes in the generation side or poor model of detector conditions the in the reconstruction side. The discrepancy should be quantified as a source systematic uncertainties. The MC simulation plays a crucial role in the data analysis and could affect our final results significantly. In order to compare the consistency between data and MC, we need to look at the B-meson signal only candidates. In the MC, we can simply apply GEN Match selection to select all B-meson signal candidates. In the data, we need to reject the background and extract the signal. After that, we compare the normalized distributions of the data and MC to compare their shapes. 

To carry out MC-Data comparison studies, the dedicated \textit{Splot} method is used. This is a likelihood-based method by which we reweigh the data using the unbinned fit result. The weights are added to the dataset based on model and yield extraction variables. Each event has two weights: probability of belonging to the signal given its mass, probability of belonging to the background given its mass. The \textit{Splot} class gives us the distributions of our variables for a given species (signal or background). The advantage of using this method is that we use the full dataset for the comparison in contrast to the sideband subtraction method where one should select the investigation range of signal and background. Furthermore, we use likelihood to describe events' behavior in contrast to the potential misidentification of signal events in background region which might occur in sideband subtraction method. 

First, in order to apply Splot, we need to confirm our variables are indeed not correlated to the invariant mass. Therefore, the correlation matrices for BDT variables vs $B^+$ invariant mass (Bmass) for data and MC are shown in Figure~\ref{BPBDTCorr}:


\begin{figure}[h]
\begin{center}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BsBDTCorrB.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BsBDTCorrB.pdf}
\caption{The correlation matrices in data (left) and MC (right) of $B^0_s$ are shown above.}
\label{BsBDTCorr}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BPBDTCorrB.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BPBDTCorrS.pdf}
\caption{The correlation matrices in data (left) and MC (right) of $B^+$ are shown above.}
\label{BPBDTCorr}
\end{center}
\end{figure}


No significant correlation between the BDT variables and the invariant mass is observed in either $B^0_s$ and $B^+$, which also validate their BDT trainings. Therefore, Splot will be applicable to compare data and MC. Here, we focus on BDT values that are directly used in our signal extraction and related to MC distribution validation, rather than the variables themselves used in BDT training. In a wide ranges of BDT, the two distributions show good agreement. We only focus on the region where BDT is greater than the working point and is smaller than the maximum value that candidates have.

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/Bs_BDT_5_10.png}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/Bs_BDT_10_15.png}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/Bs_BDT_15_20.png}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/Bs_BDT_20_50.png}
\caption{Comparison of $B^0_s$ BDT distribution in data (red) and MC (green) using Splot method.}
\label{BsMCData}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_5_7_mc_validation_Bu.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_7_10_mc_validation_Bu.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_10_15_mc_validation_Bu.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_15_20_mc_validation_Bu.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_20_30_mc_validation_Bu.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_30_40_mc_validation_Bu.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_40_50_mc_validation_Bu.pdf}
\includegraphics[width=0.45\textwidth]{Figures/Chapter4/BDT_pt_50_60_mc_validation_Bu.pdf}
\caption{Comparison of $B^+$ BDT distribution in data (red) and MC (green) using Splot method.}
\label{BPMCData}
\end{center}
\end{figure}

From Figure \ref{BPMCData}, the $B^+$ BDT variables in for all $p_T$ bins have overall reasonably good agreement between Data and MC. Their ratio is near unity with some fluctuations due to limited statistics. In the systematic section, we will quantify the discrepancy between Data and MC as a source of systematic uncertainties. For $B^0_s$, unlike $B^+$ whose statistics is in general $>$ 100, the total number of signal $B^0_s$ candidate is $<$ 100, which results in large error bar shown in Figure \ref{BsMCData}. Nonetheless, the ratio of Data to MC shape is still near unity within the large uncertainties. Nevertheless, since the events used by $B^0_s$ and $B^+$ are essentially the same and their tracks are very similar, the overall good $B^+$ Data-MC agreement can provide indirect validation to $B^0_s$. The CMS analysis note AN-19-219 \cite{AN-19-219} documents more details on general description of \textit{Splot} method applied to this analysis.  


\section{Acceptance and Efficiency Correction} 

\subsection{Overview}

Now, we have clearly seen B-meson signals and extract their signal raw yields $N_S$ from their invariant distributions. In the next step, we need to correct the acceptance and selection efficiency of the B mesons in order to obtain the cross section. The following procedures define the method we use to determine B mesons acceptance and selection efficiency with B-meson MC samples:

First, We count the total number of GEN-level B meson candidates reweighed by the centrality, PVz, and $\hat p_T$ as \textbf{NBGen} within the given B-meson rapidity region $|y| < 2.4$.

Next, we count the number of generated B meson candidates passing the follow selection 

\textbf{Muon track selections:}

\begin{equation}
\centering
\setlength\arraycolsep{20pt}
\begin{array}{l c r r}
p_T^{\mu}>3.5 GeV/c & & \text{for}\enspace |\eta^{\mu}|<1.2 & \\
p_T^{\mu}>(5.47 - 1.89\times |\eta^{\mu}|) GeV/c & &  \text{for}\enspace 1.2\le |\eta^{\mu}|<2.1 &\\
p_T^{\mu}>1.5 GeV/c & & \text{for}\enspace 2.1\le |\eta^{\mu}|<2.4 &
\end{array}
\label{eq:SingleMuonAccCuts}
\end{equation}


\textbf{Kaon track selections:}

\begin{equation}
\centering
\setlength\arraycolsep{20pt}
\begin{array}{l c r r}
p_T^{K}>0.9 GeV/c \\
|\eta^{K}| < 2.4
\end{array}
\label{eq:KaonTrackCut}
\end{equation}

to the generated B meson candidates denoted as \textbf{NPassAcc}.


Finally, we apply all the selections on the GEN-matched RECO B mesons. We count the reconstructed B meson candidates passing the selections mentioned in Section 4.5 ``Muon and $J/\psi$ candidates selections" and the optimal BDT selections in Table 3 in Section 4.1 and denote the number as \textbf{NSelPass}.

The acceptance is defined by: \textbf{acceptance = NPassAcc/NBGen}.

The selection efficiency is defined by: \textbf{selection efficiency = NSelPass/NPassAcc}.

Here, we denote $\alpha$ \textbf{as the acceptance} and $\epsilon$ \textbf{as the selection efficiency} andtheir product, which is \textbf{$\alpha \times \epsilon$ = NSelPass/NBGen}, is call (total) efficiency. 

\subsection{Tag \& Probe Techniques}

The previous subsection mentioned the efficiency correct for B-mesons using MC simulations only. However, we know that both $B^0_s$ and $B^+$ decay to $J/\psi$. A dedicated analysis techniques called tag \& probe is developed to correct the B-meson efficiency in data-driven way. The tag-\&-probe method uses the \textit{scale factor} defined the ratio of Data/MC for L2 and L3 triggered single muon efficiency tagged from the $J/\psi$ resonance \cite{TnPMethod}. There are three scale factors: identification (id), tracking (trk), and trigger (trg). Figure \ref{L2L3MuonWF} shows workflow for tag-\&-probe in B-meson analysis


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.85\textwidth]{Figures/Chapter4/L2L3MuonWF.pdf}
\caption{The workflow to obtain L2 and L3 muons in order to apply tag-\&-probe method.}
\label{L2L3MuonWF}
\end{center}
\end{figure}

The total scale factor (SF) of two muons ($SF^{\mu\mu}$) is given by the following formula

\begin{equation}
SF^{\mu\mu} = id^{\mu_1} \times trk^{\mu_1}  \times trg^{\mu_1}  \times id^{\mu_2}  \times trk^{\mu_2}  \times trg^{\mu_2} 
\end{equation}

It should note that, as mentioned in Section 2.2.5, the dimuon PbPb triggered datasets consistent of one L2 muon and one L3 muon. In our analysis, the two muons used to reconstruct B-meson are made of either one L2 muon and one L3 muon (L2,L3) or two L3 muons (L3,L3). The muon type L2 and L3 only affects the trg SF. In the (L2,L3) case, we simply correct the scale factor according to their individual scale factor values. However, in the (L3,L3) case, we take treat them as the combination of (L2,L3) and (L3,L2) by considering one of the muon as L2 muon. Then we compute the SF for both cases and take the average of the two SF as the SF for  (L3,L3).  

\subsection{Traditional Efficiency Correction Results}

Traditionally, we simply compute the efficiency as a function of binned $p_T$ and centrality and use it to correct the signal raw yield within the $p_T$ and centrality bins. The $B^0_s$ and $B^+$ acceptance, selection efficiency, and total efficiency as a function of $p_T$ and centrality are shown respectfully below in Figure \ref{BsEffAll} and Figure \ref{BPEffAll}

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BsAcc1DPtHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BsAcc1DCentHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BsSel1DPtHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BsSel1DCentHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BsEff1DPtHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BsEff1DCentHis.png}
\caption{The $B^0_s$ acceptance (top), selection efficiency (middle), and efficiency (bottom) as a function of $p_T$ (left) and event centrality (right) are shown respectfully above. We should note that there is no significant centrality dependence on the $B^0_s$ acceptance, which makes sense.}
\label{BPMCData}
\end{center}
\end{figure}


\begin{figure}[h]
\begin{center}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BPAcc1DPtHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BPAcc1DCentHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BPSel1DPtHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BPSel1DCentHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BPEff1DPtHis.png}
\includegraphics[width=0.48\textwidth]{Figures/Chapter4/BPEff1DCentHis.png}
\caption{The $B^+$ acceptance (top), selection efficiency (middle), and efficiency (bottom) as a function of $p_T$ (left) and event centrality (right) are shown respectfully above. We should note that there is no significant centrality dependence on the $B^+$ acceptance, which makes sense.}
\label{BPMCData}
\end{center}
\end{figure}


\subsection{Analysis Challenges}

Although B-meson $p_T$ and $y$ distributions are reasonably modeled by FONLL in pp collisions, the precise B-meson $p_T$ and $y$ distribution shapes are still unknown in PbPb, which could significantly affect the efficiency determination. In the following, we demonstrate of the generated B-meson kinematics how the unknown shape can affect the efficiency. 

Since we know the efficiency is given by \textbf{$\alpha \times \epsilon$ = NSelPass/NBGen}. NBGen in the simulation could not represent the truth. A weight function $w(x)$ is defined as the ratio between the generated B-meson cross section to the cross section of actual B-meson in PbPb for some kinematic variable $x$ as follows

\begin{equation}
w(x) = \frac{\sigma^{MC}_B (x)}{\sigma^{PbPb}_B (x)}
\end{equation}

Therefore, this weight function needs to be applied to both GEN-level $G(x)$ and RECO-level $R(x)$ in order to obtain the correct selection efficiency as a function of B mesons $p_T$. 


\begin{equation}
\epsilon_{corr}(x) =  \frac{\langle R(x) \rangle}{\langle G(x) \rangle}= \frac{\int R(x) w(x)dx}{\int G(x) w(x)dx}
\end{equation}

Experimentally, the data are discreet. Therefore, the measurement is done in bins. Now considering a bin of [$x_1,x_2$], the expression above is written as 

\begin{equation}
\epsilon_{corr}(x_1 < x < x_2) =  \frac{\int^{x_2}_{x_1} R(x) w(x)dx}{\int^{x_2}_{x_1} G(x) w(x)dx}
\end{equation}


When $x_1 \rightarrow x_2$, we have

\begin{equation}
\epsilon_{corr}(x_1 < x < x_2) =  \frac{\int^{x_2}_{x_1} R(x) w(x)dx}{\int^{x_2}_{x_1} G(x) w(x)dx} \sim  \frac{R(x) w(x)  (x_2 - x_1)}{G(x) w(x) (x_2 - x_1)}  = \frac{R(x)}{G(x)} = \epsilon(x)
\end{equation}

We can see that, for any non-trivial $w(x)$, with very fine bin, the effect of $w(x)$ is gone. When we measure B-meson over a large $p_T$ range, this effect could be significant, particular for $B^0_s$ where the change of efficiency between 7 -- 10 GeV/c and 10 -- 15 GeV/c and the slope of uncertainties on $w(x)$ both are huge. Hence, in order to eliminate effect of the uncertainties due to the B-meson kinematics $w(x)$ on efficiency correction, we can bin the efficiency finely.

\subsection{Fiducial Measurement}

In fact, to better estimate B-meson efficiency, we should use 2D efficiency maps as functions of B-meson $p_T$ and $|y|$. Figure \ref{Bs2DRECO} shows reconstructed $B^0_s$ and $B^+$ distribution in the MC

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/hBptByData.png}
\includegraphics[width= 0.48\textwidth]{Figures/Chapter4/hBptByMC.png}
\caption{The finely binned 2D candidates distribution vs B $p_T$ and B $|y|$ for data and MC at centrality 0 - 90\% are shown respectfully above.}
\label{Bs2DRECO}
\end{center}
\end{figure}

As we can see, for B-meson $p_T$ below 10 GeV/c, we have very little B mesons reconstructed at the rapidity region of $|y| < 1.5$. This is due to the limited acceptance of muons because the muon tracks at low $p_T$ cannot reach the muon systems. Hence, a fiducial measurement is carried out. We only correct B-meson for $p_T < 10$ GeV/c to the $1.5 < |y| < 2.4$ instead of $|y| < 2.4$. For $p_T > 10$ GeV/c, we still correct them to $|y| < 2.4$. The fiducial B-meson measurements will be carried out throughout this thesis.

\subsection{Finely Binned 2D Efficiency Map}

After unknown B-meson kinematics effects on efficiency correction and choosing the fiducial region for our measurement, we propose to measure the inverse of the total efficiency: $\frac{1}{\alpha \times \epsilon}$ as a function of $p_T$ and $|y|$ to correct the B-meson raw yield to production yield. We implement the following workflow in Figure \ref{EffWorkFlow} to estimate $\langle \frac{1}{\alpha \times \epsilon} \rangle$


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.85\textwidth]{Figures/Chapter4/EffCorrMethod.pdf}
\caption{The workflow for the efficiency correction including the data driven tag-and-probe approach in B-meson analysis is shown above.}
\label{EffWorkFlow}
\end{center}
\end{figure}

The $\frac{1}{\alpha \times \epsilon}$ applied with the tag-\&-probe SFs as functions of $p_T$ and $|y|$ for $B^0_s$ and $B^+$ are shown on Figure \ref{Bs2DMap} and Figure \ref{BP2DMap} respectfully 

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BsEff2D_0_90.png}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BsEff2D_0_30.png}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BsEff2D_30_90.png}
\caption{The finely binned 2D $\frac{1}{\alpha \times \epsilon}$ vs $B^0_s$ $p_T$ and B $|y|$ for 0 - 90\% (top), 0 - 30\% (middle), and 30\% - 90\% (bottom) centrality are shown respectfully above.}
\label{Bs2DMap}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BPEff2D_0_90.png}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BPEff2D_0_30.png}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BPEff2D_30_90.png}
\caption{The finely binned 2D $\frac{1}{\alpha \times \epsilon}$ vs $B^+$ $p_T$ and B $|y|$ for 0 - 90\% (top), 0 - 30\% (middle), and 30\% - 90\% (bottom) centrality are shown respectfully above.}
\label{BP2DMap}
\end{center}
\end{figure}



\subsection{Data-Drive Efficiency Correction}

Finally, we propose to correct the efficiency with a data-driven method. We correct the signal B-meson candidate efficiency. This can be done by looping B-meson data signal region candidates on the 2D $\frac{1}{\alpha \times \epsilon}$ map according their kinematics. Then, referring to techniques of the published $J/\psi$ analysis \cite{DataAve}, we compute the average of all signal B-meson candidate efficiency: $\langle\frac{1}{\alpha \times \epsilon} \rangle$ within the $p_T$ and centrality bins. Here, we call $\langle\frac{1}{\alpha \times \epsilon} \rangle$ as the efficiency correction factor. 

It should note that we will measure  $\langle\frac{1}{\alpha \times \epsilon \rangle}$ instead of $\frac{1}{\langle\alpha \times \epsilon \rangle}$ is because $\langle\frac{1}{\alpha \times \epsilon} \rangle$ has better closure. A dedicated closure test on this approach will be carried out and the results discussed the Section 4.11. 

Also, there are background contaminations even within the signal region. This could be improve by Splot method. However, it turns out that the difference in the efficiency between applying Splot and not applying Splot is very small. We do not consider using the Splot method in this measurement. 

Finally, this method only gives the nominal results. The statistical uncertainties turn out to be correlated with the both the data and MC statistics. A dedicated data bootstrapping approach to estimate the statistical uncertainties of the efficiency correction factor $\frac{1}{\langle\alpha \times \epsilon \rangle}$ will be carried out in Section 4.12.

\subsection{Results}

After applying data-drive method to compute efficiency correction factor, we obtain Figure \ref{BsEffFig} and Figure \ref{BPEffFig} showing $\langle\frac{1}{\alpha \times \epsilon} \rangle$ as a function $p_T$ and centrality for both $B_s^0$ and $B^+$.


\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/EffPlotPt.pdf}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/EffPlotCent.pdf}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/EffPlotCentInc.pdf}
\caption{The $B^0_s$ efficiency correction factor $\langle\frac{1}{\alpha \times \epsilon} \rangle$ vs $p_T$ (left) and 0 -- 30 \% and 30 -- 90\% centrality (middle) and the inclusive 0 -- 90\% centrality (right) are shown above.}
\label{BsEffFig}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BPEffPlotPt.pdf}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BPEffPlotCent.pdf}
\includegraphics[width= 0.32\textwidth]{Figures/Chapter4/BPEffPlotCentInc.pdf}
\caption{The  $B^+$ efficiency correction factor $\langle \frac{1}{\alpha \times \epsilon} \rangle$ vs $p_T$ (left) and 0 -- 30 \% and 30 -- 90\% centrality (middle) and the inclusive 0 -- 90\% centrality (right) are shown above.}
\label{BPEffFig}
\end{center}
\end{figure}




Table \ref{BsEffTab} and \ref{BPEffTab} summarize the nominal efficiency of $B^0_s$ and $B^+$ respectfully and their upper and lower asymmetric statistical uncertainties obtained from Section 4.12.
%\section{Cross Section Results} 


\begin{table}[h]
\begin{center}
\caption{The summary table of $B^0_s$ efficiency correction factor $\langle\frac{1}{\alpha \times \epsilon \rangle}$ for each $p_T$ and centrality bin.}
\vspace{1em}
\label{BsEffTab}
  \begin{tabular}{ |c|c|c|c|c|}
    \hline 
Centrality (\%) & $B^0_s$ $p_T$ (GeV/c) & $\langle\frac{1}{\alpha \times \epsilon \rangle}$ & $\langle\frac{1}{\alpha \times \epsilon \rangle}$ Error Up +) &$\langle\frac{1}{\alpha \times \epsilon \rangle}$ Error Down -) \\
     \hline
0 -- 90 & 7 -- 10 & 381.5  &  19.3\% & 20.3\% \\
0 -- 90 & 10 -- 15 & 75.92 &  12.4\% & 12.3\% \\
0 -- 90 & 15 -- 20 & 22.35 &   6.41\% & 6.47\% \\
0 -- 90 & 20 -- 50 & 10.63 & 5.90\% &  6.20\% \\
0 -- 30 & 10 -- 50 & 45.90 & 14.9\% & 14.6\%  \\
30 -- 90 & 10 -- 50 & 14.19 & 10.3\% & 9.78\% \\
0 -- 90 & 10 -- 50 & 34.90 & 17.9\% & 16.3\% \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}


\begin{table}[h]
\begin{center}
\caption{The summary table of $B^+$ efficiency correction factor $\frac{1}{\langle\alpha \times \epsilon \rangle}$ for each $p_T$ and centrality bin.}
\vspace{1em}
\label{BPEffTab}
  \begin{tabular}{ |c|c|c|c|c|}
    \hline 
Centrality (\%) & $B^+$ $p_T$ (GeV/c) &$\langle\frac{1}{\alpha \times \epsilon \rangle}$ & $\langle\frac{1}{\alpha \times \epsilon \rangle}$ Error Up +) & $\langle\frac{1}{\alpha \times \epsilon \rangle}$ Error Down -) \\
     \hline
0 -- 90 & 7 -- 10 & 105.9  &  15.8\% & 15.1\% \\
0 -- 90 & 10 -- 15 & 37.55 &  4.10\% & 7.95\% \\
0 -- 90 & 15 -- 20 & 10.94 &   6.54\% & 6.50\% \\
0 -- 90 & 20 -- 50 & 5.932 & 6.90\% &  5.26\% \\
0 -- 30 & 10 -- 50 & 21.67 & 5.81\% & 5.54\%  \\
30 -- 90 & 10 -- 50 & 12.28 & 6.71\% & 7.06\% \\
0 -- 90 & 10 -- 50 & 19.23 & 5.06\% & 4.54\% \\
     \hline
    \hline
\end{tabular}
\end{center}
\end{table}

At this point, we have all the ingredient to measure the B-meson cross section and study the physics. But before that, some more steps need to be complete. 

\section{Validation Tests} 

\subsection{Mass Scraping Test}

\subsection{Raw Yield Closure}

\subsection{Efficiency Closure}

\subsection{\textit{Splot} Closure}


\section{Statistical Uncertainties Determination} 

\subsection{Data Bootstrapping}

\subsection{Statistical Uncertainties Interpretation}

\section{Systematic Uncertainties Estimation} 

\subsection{Global Observables}

\subsection{Branching Ratios}

\subsection{Tracking Efficiency}

\subsection{Muon Efficiency}

\subsection{Selection Efficiency}

\subsection{Signal Extraction}

\subsection{Summary}

\section{Final Results} 

\subsection{Overview}

\subsection{$B^0_s$ and $B^{+}$ Cross Section}

\subsection{$B^0_s/B^{+}$ Ratio}

%\subsection{$B^0_s$ and $B^{+}$ Nuclear Modification Factor}

